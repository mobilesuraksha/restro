<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Display | Ram Kishan's Sweets & Restaurant</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        body { 
            background-color: #0f172a; 
            color: white; 
            font-family: 'Inter', sans-serif; 
            overflow: hidden; 
        }
        
        .brand-font { font-family: 'Playfair Display', serif; }

        /* Background Pattern */
        .bg-pattern {
            background-image: radial-gradient(#ea580c 1px, transparent 1px);
            background-size: 40px 40px;
            opacity: 0.1;
        }

        /* Animations */
        .blink-animation { animation: blinker 1.5s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .slide-in { animation: slideIn 0.5s ease-out forwards; opacity: 0; transform: translateX(20px); }
        @keyframes slideIn { to { opacity: 1; transform: translateX(0); } }

        .pop-in { animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        /* Glass Cards */
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="h-screen flex flex-col relative">

    <div class="absolute inset-0 bg-pattern pointer-events-none"></div>
    
    <div id="startOverlay" class="fixed inset-0 bg-black/95 z-50 flex flex-col items-center justify-center cursor-pointer transition-opacity duration-500">
        <div class="w-28 h-28 rounded-full border-4 border-orange-500 flex items-center justify-center animate-bounce shadow-[0_0_50px_rgba(234,88,12,0.5)]">
            <i class="fas fa-play text-5xl text-orange-500 pl-2"></i>
        </div>
        <h1 class="text-4xl font-bold mt-8 tracking-wider">CLICK TO START DISPLAY</h1>
        <p class="text-gray-400 mt-2">Enable Audio System</p>
    </div>

    <header class="h-24 bg-slate-900 border-b border-orange-900/50 flex items-center justify-between px-10 z-10 shadow-lg">
        <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-gradient-to-br from-orange-500 to-red-600 rounded-full flex items-center justify-center text-white text-2xl shadow-lg">
                <i class="fas fa-utensils"></i>
            </div>
            <div>
                <h1 class="text-3xl font-bold text-white brand-font tracking-wide">Ram Kishan's</h1>
                <p class="text-orange-400 text-xs font-bold uppercase tracking-[0.3em]">Sweets & Restaurant</p>
            </div>
        </div>
        
        <div class="text-right">
            <div id="clockTime" class="text-3xl font-black text-gray-200">00:00</div>
            <div id="clockDate" class="text-sm text-gray-500 font-bold uppercase">Loading Date...</div>
        </div>
    </header>

    <main class="flex-1 flex z-10">
        
        <div class="w-[65%] border-r border-slate-800 flex flex-col items-center justify-center relative p-10 bg-gradient-to-b from-slate-900 to-slate-950">
            
            <div class="absolute top-10 left-10 flex items-center gap-3">
                <span class="relative flex h-5 w-5">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-5 w-5 bg-orange-500"></span>
                </span>
                <span class="text-orange-500 text-2xl font-bold uppercase tracking-widest">Now Calling</span>
            </div>

            <div id="activeCallArea" class="text-center transition-all duration-700 opacity-20 scale-90 blur-sm">
                
                <div class="text-[250px] font-black text-white leading-none tracking-tighter drop-shadow-2xl" id="bigToken">
                    ---
                </div>
                
                <div class="text-6xl font-bold text-orange-400 mt-4 mb-2 truncate max-w-4xl mx-auto" id="bigName">
                    Waiting for Guest...
                </div>

                <div class="flex justify-center items-center gap-6 mt-10">
                    <div class="glass-card px-8 py-4 rounded-2xl flex items-center gap-4">
                        <i class="fas fa-users text-gray-400 text-2xl"></i>
                        <span class="text-3xl font-bold text-white"><span id="bigPax">0</span> Persons</span>
                    </div>
                </div>

                <div class="mt-12">
                    <div class="inline-block bg-green-600 text-white px-16 py-6 rounded-full text-6xl font-black shadow-[0_0_60px_rgba(22,197,94,0.6)] animate-bounce" id="tableBadge">
                        Table <span id="bigTable">--</span>
                    </div>
                </div>

            </div>
        </div>

        <div class="w-[35%] bg-slate-900 flex flex-col">
            <div class="p-8 border-b border-slate-800 bg-slate-800/50">
                <h2 class="text-3xl font-bold text-gray-200 flex items-center gap-3">
                    <i class="fas fa-list-ol text-orange-500"></i> Up Next
                </h2>
            </div>
            
            <div id="waitList" class="flex-1 overflow-hidden p-6 space-y-4">
                </div>
            
            <div class="p-6 bg-slate-950 border-t border-slate-800 text-center">
                <p class="text-gray-500 text-lg">Please check your phone for updates</p>
                <div class="flex justify-center gap-4 mt-2 text-orange-500/50 text-2xl">
                    <i class="fab fa-whatsapp"></i>
                    <i class="fas fa-mobile-alt"></i>
                </div>
            </div>
        </div>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getFirestore, collection, query, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

        // FIREBASE CONFIGURATION (Exact Keys Provided)
        const firebaseConfig = {
            apiKey: "AIzaSyAVZfBaUEQxszbuDXsoFJ6uW2_5XqBulRE",
            authDomain: "waiting-9617c.firebaseapp.com",
            projectId: "waiting-9617c",
            storageBucket: "waiting-9617c.firebasestorage.app",
            messagingSenderId: "698708284819",
            appId: "1:698708284819:web:3732cf42140cba84494466"
        };

        // Initialize App
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- AUDIO SYSTEM ---
        const synth = window.speechSynthesis;
        let audioEnabled = false;

        document.getElementById('startOverlay').addEventListener('click', () => {
            document.getElementById('startOverlay').style.opacity = '0';
            setTimeout(() => document.getElementById('startOverlay').style.display = 'none', 500);
            audioEnabled = true;
            announce("Welcome to Ram Kishan's Sweets and Restaurant");
        });

        function announce(text) {
            if (!audioEnabled) return;
            synth.cancel(); // Stop any current speech
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.85; // Slightly slower for clarity
            utterance.pitch = 1;
            utterance.volume = 1;
            synth.speak(utterance);
        }

        // --- REAL-TIME CLOCK ---
        function updateClock() {
            const now = new Date();
            document.getElementById('clockTime').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('clockDate').innerText = now.toLocaleDateString([], { weekday: 'long', month: 'short', day: 'numeric' });
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- DATABASE LISTENER ---
        const q = query(collection(db, "guests"), orderBy("createdAt", "asc"));

        onSnapshot(q, (snapshot) => {
            const listContainer = document.getElementById('waitList');
            listContainer.innerHTML = ""; // Clear list to rebuild
            
            let activeCallFound = false;

            // 1. Check for specific updates (Calls)
            snapshot.docChanges().forEach((change) => {
                if (change.type === 'modified') {
                    const d = change.doc.data();
                    if (d.status === 'called') {
                        updateBigScreen(d);
                        // Trigger Audio Announcement
                        const message = `Token Number ${d.token}, ${d.name}, please proceed to Table ${d.table}`;
                        announce(message);
                    }
                }
            });

            // 2. Rebuild Lists
            snapshot.forEach((doc) => {
                const guest = doc.data();

                // Maintain Big Screen if someone is currently being called
                if (guest.status === 'called') {
                    activeCallFound = true;
                    updateBigScreen(guest);
                }

                // Populate Waiting List (Max 5 items to fit screen)
                if (guest.status === 'waiting') {
                    // Determine Icon based on Area
                    let areaIcon = 'üè†';
                    if(guest.area === 'AC Hall') areaIcon = '‚ùÑÔ∏è';
                    else if(guest.area === 'Garden') areaIcon = 'üå≥';
                    else if(guest.area === 'Rooftop') areaIcon = 'üåô';

                    const itemHtml = `
                        <div class="bg-slate-800 p-5 rounded-xl border-l-4 border-orange-500 flex justify-between items-center slide-in shadow-lg relative overflow-hidden group">
                            <div class="absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition"></div>
                            <div class="relative z-10">
                                <div class="text-4xl font-black text-white">#${guest.token}</div>
                                <div class="text-orange-200 font-semibold text-lg truncate w-40">${guest.name}</div>
                            </div>
                            <div class="text-right relative z-10">
                                <div class="bg-slate-700 px-3 py-1 rounded-lg text-2xl font-bold text-gray-300">
                                    ${guest.pax} <i class="fas fa-user text-sm"></i>
                                </div>
                                <div class="text-xs text-gray-500 mt-2 font-bold uppercase tracking-wider">
                                    ${areaIcon} ${guest.preference || 'Regular'}
                                </div>
                            </div>
                        </div>
                    `;
                    // Limit list to avoid overflow
                    if (listContainer.children.length < 5) {
                        listContainer.innerHTML += itemHtml;
                    }
                }
            });

            // If nobody is "called", dim the main screen
            if (!activeCallFound) {
                resetBigScreen();
            }
        });

        // --- SCREEN UPDATE FUNCTIONS ---
        function updateBigScreen(data) {
            const area = document.getElementById('activeCallArea');
            const token = document.getElementById('bigToken');
            
            // Bring to focus
            area.classList.remove('opacity-20', 'scale-90', 'blur-sm');
            area.classList.add('opacity-100', 'scale-100', 'blur-0');
            
            // Update Text
            token.innerText = data.token;
            token.classList.add('blink-animation'); // Add blink effect
            
            document.getElementById('bigName').innerText = data.name;
            document.getElementById('bigPax').innerText = data.pax;
            document.getElementById('bigTable').innerText = data.table;
        }

        function resetBigScreen() {
            const area = document.getElementById('activeCallArea');
            const token = document.getElementById('bigToken');
            
            // Fade out
            area.classList.add('opacity-20', 'scale-90', 'blur-sm');
            area.classList.remove('opacity-100', 'scale-100', 'blur-0');
            
            token.classList.remove('blink-animation'); // Stop blink
        }

    </script>
</body>
</html>